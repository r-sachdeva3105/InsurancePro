<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<title>InsurancePro - Customer Management</title>
	<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-900">
	<!-- Header -->
	<header class="bg-gray-800 text-white shadow-md">
		<div class="container mx-auto px-6 py-4 flex justify-between items-center">
			<a href="dashboard.html" class="text-2xl font-bold text-white">InsurancePro</a>
			<nav class="space-x-4">
				<span>Welcome, John Doe</span>
				<a href="login.html" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Logout</a>
			</nav>
		</div>
	</header>

	<!-- Sidebar and Main Content Wrapper -->
	<div class="flex">
		<!-- Sidebar -->
		<aside class="w-64 bg-gray-800 text-white h-screen hidden md:block">
			<div class="px-6 py-6">
				<ul>
					<li class="mb-4">
						<a href="dashboard.html"
							class="text-white font-semibold block hover:bg-gray-700 px-4 py-2 rounded">Dashboard</a>
					</li>
					<li class="mb-4">
						<a href="customers.html"
							class="text-white font-semibold block bg-gray-900 hover:bg-gray-700 px-4 py-2 rounded">Customers</a>
					</li>
					<li class="mb-4">
						<a href="policies.html"
							class="text-white font-semibold block hover:bg-gray-700 px-4 py-2 rounded">Policies</a>
					</li>
				</ul>
			</div>
		</aside>

		<!-- Main Content -->
		<main class="flex-1 p-6">
			<h1 class="text-4xl font-bold mb-6">Customer Management</h1>

			<!-- Search Bar -->
			<div class="mb-6">
				<input type="text" placeholder="Search by name or ID"
					class="w-full p-4 border border-gray-300 rounded-lg" />
			</div>

			<!-- Add Customer Button -->
			<div class="flex justify-end mb-4">
				<button class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
					onclick="toggleAddCustomerForm()">
					Add New Customer
				</button>
			</div>

			<!-- Customer List Table -->

			<body>
				<h2>Customer List</h2>

				<!-- Table container -->
				<div class="overflow-x-auto bg-white rounded-lg shadow-md">
					<table class="min-w-full leading-normal">
						<thead>
							<tr>
								<th
									class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
									ID</th>
								<th
									class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
									Name</th>
								<th
									class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
									Email</th>
								<th
									class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
									Phone</th>
								<th
									class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
									Actions</th>
							</tr>
						</thead>
						<tbody id="customerTableBody">
							<!-- Data will be inserted here -->
						</tbody>
					</table>
				</div>

				<!-- Add Customer Form (Hidden by default) -->
				<div id="addCustomerForm" class="hidden mt-6">
					<h2 class="text-2xl font-bold mb-4">Add New Customer</h2>
					<form class="bg-white p-6 rounded-lg shadow-md space-y-4" action="AddCustomerServlet" method="POST">
						<div>
							<label for="id" class="block text-sm font-medium text-gray-700">Customer Id</label>
							<input type="text" id="id" class="mt-1 p-2 w-full border border-gray-300 rounded-lg"
								placeholder="1" name="id" />
						</div>
						<div>
							<label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
							<input type="text" id="name" class="mt-1 p-2 w-full border border-gray-300 rounded-lg"
								placeholder="John Doe" name="name" />
						</div>
						<div>
							<label for="email" class="block text-sm font-medium text-gray-700">Email</label>
							<input type="email" id="email" class="mt-1 p-2 w-full border border-gray-300 rounded-lg"
								placeholder="johndoe@example.com" name="email" />
						</div>
						<div>
							<label for="phone" class="block text-sm font-medium text-gray-700">Phone</label>
							<input type="text" id="phone" class="mt-1 p-2 w-full border border-gray-300 rounded-lg"
								placeholder="+1 123 456 7890" name="phone" />
						</div>
						<div>
							<button type="submit"
								class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
								Save
							</button>
						</div>
					</form>
				</div>
		</main>
	</div>

	<script>
		function toggleAddCustomerForm() {
			const form = document.getElementById("addCustomerForm");
			form.classList.toggle("hidden");
		}
		// Fetch customer data from the ViewServlet and populate the table
		window.addEventListener("load", function () {
			fetch('ViewCustomerServlet')
				.then(response => response.json()) // Assuming the servlet returns JSON data
				.then(data => {
					const tableBody = document.getElementById("customerTableBody");

					if (data.length > 0) {
						tableBody.innerHTML = data.map(customer => `
                            <tr>
                                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">${customer.id}</td>
                                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">${customer.name}</td>
                                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">${customer.email}</td>
                                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">${customer.phone}</td>
                                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm space-x-2">
                                    <button class="text-green-600 hover:text-green-900" onclick="editCustomer(${customer.id})">Edit</button>
                                    <button class="text-red-600 hover:text-red-900" onclick="deleteCustomer(${customer.id})">Delete</button>
                                </td>
                            </tr>
                        `).join('');
					} else {
						tableBody.innerHTML = `<tr><td colspan="5" class="px-5 py-5 border-b border-gray-200 bg-white text-sm">No customers found.</td></tr>`;
					}
				})
				.catch(error => {
					console.error('Error fetching customers:', error);
					document.getElementById("customerTableBody").innerHTML = `<tr><td colspan="5" class="px-5 py-5 border-b border-gray-200 bg-white text-sm">Error loading customers.</td></tr>`;
				});
		});
		function deleteCustomer(customerId) {
			// Sending POST request to DeleteServlet with customer ID
			fetch('DeleteCustomerServlet', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
				},
				body: `id=${customerId}` // Sending ID in the request body
			})
				.then(response => {
					if (response.ok) {
						console.log('Customer deleted successfully');
						window.location.reload(); // Optionally, reload the page
					} else {
						console.error('Failed to delete customer');
					}
				})
				.catch(error => {
					console.error('Error deleting customer:', error);
				});
		}


	</script>
</body>

</html>